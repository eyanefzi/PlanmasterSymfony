{% extends 'base.html.twig' %}

{% block title %}Your Cart{% endblock %}

{% block body %}
<div class="container py-4">
    <h1 class="mb-4 text-primary">ðŸ›’ Your Cart</h1>

    <div id="cart-items"></div>

    {% if cartItems is empty %}
        <p>Your cart is empty!</p>
        <a href="{{ path('app_store_products') }}" class="btn btn-primary">Continue Shopping</a>
    {% else %}
        <ul class="list-group" id="cart-list">
            <!-- Cart items will be appended here dynamically -->
        </ul>

        <div class="mt-3">
            <h4>Total Amount: â‚¬<span id="total-amount">0</span></h4>
            <form method="post" action="{{ path('app_store_confirm_purchase') }}">
                <button type="submit" class="btn btn-success">Confirm Purchase</button>
            </form>
        </div>
    {% endif %}
</div>
{% endblock %}

<script>
    // Fetch cart items from localStorage and render them dynamically
    document.addEventListener('DOMContentLoaded', function() {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        const cartList = document.getElementById('cart-list');
        const totalAmountElement = document.getElementById('total-amount');
        let totalAmount = 0;

        if (cart.length === 0) {
            document.getElementById('cart-items').innerHTML = '<p>Your cart is empty!</p>';
        } else {
            cart.forEach(item => {
                const listItem = document.createElement('li');
                listItem.classList.add('list-group-item');

                const itemTotal = item.price * item.quantity;
                totalAmount += itemTotal;

                listItem.innerHTML = `
                    <h5>Product: ${item.name}</h5>
                    <p>Price: â‚¬${item.price}</p>
                    <p>Quantity: ${item.quantity}</p>
                    <p>Total: â‚¬${itemTotal}</p>
                `;
                cartList.appendChild(listItem);
            });

            // Display total amount
            totalAmountElement.textContent = totalAmount.toFixed(2);
        }
    });
</script>
